<!DOCTYPE html>
<html id="base" lang="it" data-theme="emerald">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.14.2/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="pokeFinder.css">
    <title> PokeType </title>
</head>
<body class="slowAppear" style="display:none">
    
    <!-- Navbar -->
    <div class="navbar bg-accent rounded-b-lg text-white shadow-xl" style="position:fixed; top:0; z-index: 1;">
        <div class="flex-1">
            <a href="index.html" class="btn btn-ghost normal-case text-xl">PokeType</a>
        </div>
        <div class="flex-none mr-2">
            <label class="swap swap-rotate">
            <!-- this hidden checkbox controls the state -->
            <input id="theme" type="checkbox" />
            
            <!-- sun icon -->
            <svg class="swap-on fill-current w-10 h-10" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/></svg>
            
            <!-- moon icon -->
            <svg class="swap-off fill-current w-10 h-10" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/></svg>
            
            </label>
        </div>
    </div>

    <!-- Titolo -->
    <div class="m-4 md:grid grid-cols-3">
        <div></div>
        <div class="mt-24 md:col-span-1"> <img id="title" class="flex justify-center w-fit" src="img/chooseAtype.png"></div>
        <div></div>
    </div>

    <!-- Pulsanti per cercare tipo -->
    <div class="wrapper p-8 flex flex-wrap justify-center">
        <div class="icon bug" onclick="findType('bug')">
            <img src="icons/bug.svg"/>
        </div>
        <div class="icon dark" onclick="findType('dark')">
            <img src="icons/dark.svg"/>
        </div>
        <div class="icon dragon" onclick="findType('dragon')">
            <img src="icons/dragon.svg"/>
        </div>
        <div class="icon electric" onclick="findType('electric')">
            <img src="icons/electric.svg"/>
        </div>
        <div class="icon fairy" onclick="findType('fairy')">
            <img src="icons/fairy.svg"/>
        </div>
        <div class="icon fighting" onclick="findType('fighting')">
            <img src="icons/fighting.svg"/>
        </div>
        <div class="icon fire" onclick="findType('fire')">
            <img src="icons/fire.svg"/>
        </div>
        <div class="icon flying" onclick="findType('flying')">
            <img src="icons/flying.svg"/>
        </div>
        <div class="icon ghost" onclick="findType('ghost')">
            <img src="icons/ghost.svg"/>
        </div>
        <div class="icon grass" onclick="findType('grass')">
            <img src="icons/grass.svg"/>
        </div>
        <div class="icon ground" onclick="findType('ground')">
            <img src="icons/ground.svg"/>
        </div>
        <div class="icon ice" onclick="findType('ice')">
            <img src="icons/ice.svg"/>
        </div>
        <div class="icon normal" onclick="findType('normal')">
            <img src="icons/normal.svg"/>
        </div>
        <div class="icon poison" onclick="findType('poison')">
            <img src="icons/poison.svg"/>
        </div>
        <div class="icon psychic" onclick="findType('psychic')">
            <img src="icons/psychic.svg"/>
        </div>
        <div class="icon rock" onclick="findType('rock')">
            <img src="icons/rock.svg"/>
        </div>
        <div class="icon steel" onclick="findType('steel')">
            <img src="icons/steel.svg"/>
        </div>
        <div class="icon water" onclick="findType('water')">
            <img src="icons/water.svg"/>
        </div>
    </div>
    <div id="openList" class="grid grid-cols-1 sm:grid-cols-6"> </div>
</body>
    <script>
        //limite dei caratteri di un pokemon
        const limitChar=12;
        //I pokemon oltre gli 890 sono pokemon speciali non di interesse per l'utente
        const maxPokemon=890;

        //Funzione chiamata quando premuto il pulsante di un tipo
        function findType(type) {
            //Cancella se c'erano elementi prima
            $("#openList").empty();

            let pokeArray;
            $.getJSON("https://pokeapi.co/api/v2/type/"+type+"/", function (data) {
                //contiene tutti i pokemon, con nome e url
                pokeArray=data.pokemon;
                //contiene id per vedere se l'id del pokemon va oltre i pokemon che si vogliono mostrare
                let tempID;
                let toDelete=new Array();
                //console.log(pokeArray);
                $.each(pokeArray, function(key,val) {
                    tempID=val.pokemon.url;
                    //ricaviamo l'id del pokemon per capire se non deve essere inserito
                    tempID=tempID.substring(34,((val.pokemon.url).length)-1);
                    if (tempID>maxPokemon) {
                        //mettiamo nell'array di pokemon da cancellare se ha un id troppo alto
                        toDelete.push(key);
                    }
                });

                //Cancella nel pokeArray tanti elementi quanti ne ha toDelete
                $.each(toDelete, function(key,val) {
                    pokeArray.pop();
                });

                //Inseriamo i pokemon nel div, appendendoli a openList
                $.each(pokeArray, function(key,val) {
                    console.log(val.pokemon.name+" - "+key+" - "+val.pokemon.url);
                    $("#openList").append(`
                    <div></div>
                    <div class="stats shadow my-1 sm:col-span-4" style="display:none;">
                        <div class="stat">
                            <div class="stat-figure text-secondary">
                                <div class="avatar border-2 border-accent" style="background:white; border-radius:35%;">
                                    <div class='image_`+val.pokemon.name+`'> </div>
                                </div>
                            </div>
                            <div class="stat-value pokemon-name"> `+ limitString(firstUpperCase(val.pokemon.name)) +` </div>
                            <div class="stat-title pokemon-types-`+val.pokemon.name+`"> </div>
                            <div class="stat-desc pokemon-central-wiki-link"> <a href="https://wiki.pokemoncentral.it/`+val.pokemon.name+`" target="blank" class="text-accent"> Clicca per aprire la wiki </a> </div>
                        </div>
                    </div><div></div>`);
                    $(".stats").fadeIn( "slow" );
                });
                //console.log(pokeArray);

                //Inseriamo nei div vuoti, l'immagine del pokemon e i suoi tipi
                $.each(pokeArray, function(key,val) {
                    $.getJSON("https://pokeapi.co/api/v2/pokemon/"+val.pokemon.name+"/", function (data) {
                        $(".image_"+val.pokemon.name).replaceWith(`<img class='image_`+val.pokemon.name+`'src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-viii/icons/`+data.id+`.png' style="width:75px; height:75px">`);
                        //se data.types[1] esiste, significa che il pokemon ha due tipi
                        if (data.types[1]) {
                            $(".pokemon-types-"+val.pokemon.name).replaceWith('<div class="stat-title pokemon-types">'+firstUpperCase(data.types[0].type.name)+'/'+firstUpperCase(data.types[1].type.name)+'</div>');
                        }
                        else {
                            $(".pokemon-types-"+val.pokemon.name).replaceWith('<div class="stat-title pokemon-types">'+firstUpperCase(data.types[0].type.name)+'</div>');
                        }
                    });
                });
            });   
        }

        function firstUpperCase(string) {
            //rendiamo il primo carattere della stringa maiuscolo e il resto lo lasciamo uguale
            return string[0].toUpperCase() + string.slice(1);
        }

        function limitString(string) {
            let result=string;
            if (string.length>limitChar) {
                //console.log("limitiamo caratteri...");
                string=string.substring(0,limitChar);
                //facciamo capire all'utente di aver troncato i nomi
                string+="...";
                console.log(string);
            }
            return string;
        }

    $(document).ready(function() {
        //La classe slowAppear viene data al body intero
        $(".slowAppear").fadeIn( "slow" );

        var usingWhiteTheme=true;
        //Funzione chiamata quando si vuole cambiare tema
        $('#theme').change(function() {
            if (usingWhiteTheme) {
                $('#base').attr({"data-theme":"business"});
                $('#title').attr({"src":"img/chooseAtype_white.png"});
                usingWhiteTheme=false;
            }
            else {
                $('#base').attr({"data-theme":"emerald"});
                $('#title').attr({"src":"img/chooseAtype.png"});
                usingWhiteTheme=true;
            }
        });
    });

        
    </script>
</html>